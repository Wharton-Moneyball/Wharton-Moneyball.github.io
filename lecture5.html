<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lecture 5: Advanced Visualization and Other Data Sources</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><img id="logo" style="width: 200px;" src="figures/WMA_logo.png" /></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-sign-in"></span>
     
    Get Started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lecture0.html">Lecture 0</a>
    </li>
    <li>
      <a href="ps0.html">Problem Set 0</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-institution"></span>
     
    Academy
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lecture1.html">Lecture 1</a>
    </li>
    <li>
      <a href="lecture2.html">Lecture 2</a>
    </li>
    <li>
      <a href="lecture3.html">Lecture 3</a>
    </li>
    <li>
      <a href="lecture4.html">Lecture 4</a>
    </li>
    <li>
      <a href="lecture5.html">Lecture 5</a>
    </li>
    <li>
      <a href="lecture6.html">Lecture 6</a>
    </li>
    <li>
      <a href="lecture7.html">Lecture 7</a>
    </li>
    <li>
      <a href="lecture8.html">Lecture 8</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="ps1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="ps2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="ps3.html">Problem Set 3</a>
    </li>
    <li>
      <a href="ps4.html">Problem Set 4</a>
    </li>
    <li>
      <a href="ps5.html">Problem Set 5</a>
    </li>
    <li>
      <a href="ps6.html">Problem Set 6</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="lecture_nflfastR.html">nflfastR Lecture</a>
    </li>
    <li>
      <a href="psX.html">Problem Set X</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-dribbble"></span>
     
    Training Camp
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="tc_lecture1.html">Lecture 1</a>
    </li>
    <li>
      <a href="tc_lecture2.html">Lecture 2</a>
    </li>
    <li>
      <a href="tc_lecture3.html">Lecture 3</a>
    </li>
    <li>
      <a href="tc_lecture4.html">Lecture 4</a>
    </li>
    <li>
      <a href="tc_lecture5.html">Lecture 5</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="tc_ps1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="tc_ps2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="tc_ps3.html">Problem Set 3</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="tc_lecture_data_sources.html">Data Sources Lecture</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lecture 5: Advanced Visualization and Other
Data Sources</h1>

</div>


<p>In <a href="lecture2.html">Lecture 2</a>, we saw that visualization
using ggplot could provide important insights into large datasets.
Today, we will learn more about ggplot and use what we have learned to
study the relationship between batting averages in consecutive
seasons.</p>
<div id="visualizing-the-diving-dataset" class="section level2">
<h2>Visualizing the Diving Dataset</h2>
<p>In this course, we will be using the package ggplot2 for all of our
data visualization. The <code>gg</code> stands for “grammar of
graphics”, a framework for data visualization. This framework separates
the process of visualization into different components: data, aesthetic
mappings, and geometric objects. These components are then added
together (or layered) to produce the final graph. We’re going to
illustrate these components using the diving dataset from Prof. Wyner’s
lecture.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>diving <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/diving.csv&quot;</span>)</span></code></pre></div>
<div id="components-of-a-plot" class="section level3">
<h3>Components of a Plot</h3>
<p>The first step in any data visualization is to tell R which tbl the
data we want to plot lives. This is done using the <code>ggplot()</code>
function. Notice that we are <em>assigning</em> the plot to a new
variable, <code>diving_hist</code>. Later, we will <em>add</em> layers
to the plot using the <code>+</code> operator.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>diving_hist <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diving)</span></code></pre></div>
<p>Aesthetics map the data to the properties of the plot. Examples
include:</p>
<ul>
<li><code>x</code>: the variable that will be on the x-axis</li>
<li><code>y</code>: the variable that will be on the y-axis</li>
<li><code>color</code>: the variable that categorizes data by color</li>
<li><code>shape</code>: the variable that categorizes data by shape</li>
</ul>
<p>You can define the <code>aes</code> in the <code>ggplot</code> call,
which will then be used for all later layers, or you can define the
<code>aes</code> in the <code>geom</code> (see below), which will only
apply to that <code>geom</code>. Geometric objects, or
<code>geoms</code>, determine the type of plot that will be created.
Examples include:</p>
<ul>
<li><code>geom_point()</code>: creates a scatterplot</li>
<li><code>geom_histogram()</code>: creates a histogram</li>
<li><code>geom_line()</code>: creates a line</li>
<li><code>geom_boxplot()</code>: creates a boxplot</li>
</ul>
</div>
<div id="putting-it-all-together" class="section level3">
<h3>Putting it All Together</h3>
<p>Let’s make a histogram of judge’s scores.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>diving_hist <span class="ot">&lt;-</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  diving_hist <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> JScore), <span class="at">binwidth =</span> <span class="fl">0.25</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>diving_hist</span></code></pre></div>
<p><img src="lecture5_files/figure-html/diving%20hist-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In the code above, we first overwrote <code>diving_hist</code> so
that is now a histogram of judges’ scores where each bin had width 0.25.
In the second line, we asked R to display this object. <strong>For
ggplot code it is very important that the <code>+</code> goes at the end
of a line, just like the pipe <code>%&gt;%</code></strong></p>
<p>Notice that the label for the x-axis is JScore, which is the column
name from the tbl. We can change the label by <em>adding</em> a
layer.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>diving_hist <span class="ot">&lt;-</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  diving_hist <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Judge Score&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>diving_hist</span></code></pre></div>
<p><img src="lecture5_files/figure-html/diving%20hist%20x%20label-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="facets" class="section level3">
<h3>Facets</h3>
<p>What if we want to separate the judges’ scores by country? We can use
<em>facets</em>. Facets allow you to separate graphs by category. We do
not need to redo our above code for the histogram - we only need to add
a <em>facet</em> layer to our graph <code>hist</code>. The first
argument of <code>facet_wrap</code> is the column of our dataset that
contains the category information. Note that we need a tilde
(<code>~</code>) in front of <code>JCountry</code>: later in the course
we will discuss why this is needed. The second argument of
<code>facet_wrap</code> specifies the number of rows for which to
display the graphs.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>diving_hist <span class="ot">&lt;-</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  diving_hist <span class="sc">+</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> JCountry, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>diving_hist</span></code></pre></div>
<p><img src="lecture5_files/figure-html/facet_wrap-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>To get a sense of whether a particular country’s judges are biased,
it would be useful to add a reference line at the median score over all
judges and countries to each facet. So, we must first calculate the
overall median score, which we can do using the summarize function.
Then. we can display this median on our plots this with
<code>geom_vline()</code>, which adds a vertical line.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>median_score <span class="ot">&lt;-</span> diving <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">med =</span> <span class="fu">median</span>(JScore)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(med)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>diving_hist <span class="ot">&lt;-</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  diving_hist <span class="sc">+</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> median_score, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>diving_hist</span></code></pre></div>
<p><img src="lecture5_files/figure-html/facet_wrap%20median-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that when calculating our <code>median_score</code>, the
<code>summarize</code> function returns a tbl rather than a single
value. To “pull” out the single median value from our tbl, we use the
<code>pull</code> function.</p>
</div>
</div>
<div id="boxplots" class="section level2">
<h2>Boxplots</h2>
<p>Boxplots are also an important visualization tool. We now create
boxplots of the judges’ scores, separated by diving round. We can also
color our boxplots according to the <code>Round</code> variable by
including the <code>fill</code> argument within the <code>aes()</code>
function. Note that if we included the <code>fill</code> argument
outside of the <code>aes()</code> function, we would only be able to
color all boxplots the same color (by putting <code>fill</code> inside
of the aesthetic, we are able to “map” the variable <code>Round</code>
to the fill color of the plot based on the values of
<code>Round</code>).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>diving_box <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diving) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Round, <span class="at">y =</span> JScore, <span class="at">fill =</span> Round)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Diving scores by round&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Judge Score&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Round&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>diving_box</span></code></pre></div>
<p><img src="lecture5_files/figure-html/boxplot%20fill-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can also remove the unnecessary x-axis ticks and labels as the
legend on the right is sufficient. We do so using the <code>theme</code>
layer:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>diving_box <span class="ot">&lt;-</span> diving_box <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>diving_box</span></code></pre></div>
<p><img src="lecture5_files/figure-html/boxplot%20theme-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="barplots" class="section level3">
<h3>Barplots</h3>
<p>We can also create barplots using <code>geom_bar</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>bar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diving) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> JCountry, <span class="at">fill =</span> JCountry)) <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Judge Country&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Judge Country&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>bar</span></code></pre></div>
<p><img src="lecture5_files/figure-html/barplot-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="scatterplots" class="section level3">
<h3>Scatterplots</h3>
<p>Now let’s turn back to scatterplots, which were introduced in <a
href="module2.html">Module 2</a>. We plot judges’ score versus rank of
the diver. As we expect, the higher the divers’ rank, the higher their
score.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diving) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Rank, <span class="at">y =</span> JScore, <span class="at">color =</span> Country))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>scatter</span></code></pre></div>
<p><img src="lecture5_files/figure-html/scatterplot-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="lines" class="section level3">
<h3>Lines</h3>
<p>We can also add an <code>abline</code> to our scatterplot–that is, a
line where we specify the y-intercept (<code>intercept</code>) and the
slope (<code>slope</code>):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>scatter <span class="ot">&lt;-</span> scatter <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">8.1</span>, <span class="at">slope =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>scatter</span></code></pre></div>
<p><img src="lecture5_files/figure-html/scatter%20abline-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><em>Note</em>: <code>geom_abline</code> is different from
<code>geom_line</code>: <code>geom_line</code> “connects the dots”
between your data and so doesn’t have to be a straight line, whereas
<code>geom_abline</code> draws a straight line with the specified slope
and y-intercept.</p>
<p>Other <code>geom</code> for lines are:</p>
<ul>
<li><code>geom_vline</code>: to add a vertical line to a plot</li>
<li><code>geom_hline</code>: to add a horizontal line to a plot</li>
</ul>
</div>
<div id="stats" class="section level3">
<h3>Stats</h3>
<p>We can also specify a layer using <code>stat_</code>, which stands
for statistical transformation. This is useful if we want to plot a
summary statistic of our data, such as a mean or median. By using a
<code>stat_</code> layer, we do not have to compute this summary
statistic beforehand–<code>ggplot</code> will compute the summary
statistic for us and then plot the result.</p>
<p>For example, suppose we want to plot the means of each judge’s score
and provide error bars of one standard deviation on either side of the
mean. We could use <code>summarize</code> and <code>group_by</code> to
find the mean and standard deviations for each judge, <em>or</em> we
could just use a <code>stat_</code> layer!</p>
<p>The layer <code>stat_summary()</code> computes and then plots a
user-specified summary statistic. We choose the option
<code>mean_se</code> to calculate the means and standard deviations of
the scores of each judge.</p>
<p>As always, we set up the plot by calling <code>ggplot</code>,
specifying <code>data = diving</code> and then providing the
<code>aes</code>. In this case, we want the judge on the
<code>x</code>-axis and their scores on the <code>y</code>-axis. We then
add our <code>stat_summary</code> layer.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>judges <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diving, <span class="fu">aes</span>(<span class="at">x =</span> Judge, <span class="at">y =</span> JScore)) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_se) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Judge Score&quot;</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>judges</span></code></pre></div>
<p><img src="lecture5_files/figure-html/stat_summary-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can see that the judges’ names are bunched together… ideally we
would want their names to be horizontal to make it easier to read.
Luckily, <code>ggplot</code> has an easy fix for this!</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>judges <span class="ot">&lt;-</span> judges <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>judges</span></code></pre></div>
<p><img src="lecture5_files/figure-html/coord_flip-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="scales" class="section level3">
<h3>Scales</h3>
<p>Scales allow you to adjust the aesthetics or visual aspects of a
plot. We return to the scatter plot of the judges’ scores vs rank of the
divers. This time, we want to color the points by the difficulty of the
dive.</p>
<p>We use the layer <code>scale_color_distiller</code>. The second word,
<code>color</code>, is the <code>aes</code> we want to change. We can
replace it with <code>x</code>, <code>y</code> or <code>fill</code>,
depending on the <code>aes</code> we want to change.</p>
<p>The third word is <code>distiller</code>, which we use because our
<code>color</code> variable, <code>Difficulty</code>, is continuous. If
it were discrete, we would write <code>brewer</code> instead.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diving) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Rank, <span class="at">y =</span> JScore, <span class="at">color =</span> Difficulty)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;OrRd&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>scatter</span></code></pre></div>
<p><img src="lecture5_files/figure-html/scales%20scatter-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Interestingly, it seems that some of the highest ranked divers
perform most of the less difficult dives, but perform these easy dives
very well.</p>
<p>To further investigate, we plot a 2D histogram of Rank vs
Difficulty.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hist <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diving)  <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>(<span class="fu">aes</span>(<span class="at">x =</span> Rank, <span class="at">y =</span> Difficulty)) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>hist</span></code></pre></div>
<p><img src="lecture5_files/figure-html/scales%20hist-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that we use <code>fill</code> instead of <code>color</code> in
<code>scale_fill_distiller</code> to control the fill of the histogram
bins.</p>
<p>From the 2D histogram, we can see that the higher ranked divers
attempt both more difficult and less difficult dives, unlike the lower
ranked divers who only attempt more difficult dives.</p>
</div>
<div id="colorbrewer" class="section level3">
<h3>ColorBrewer</h3>
<p>The palettes used in this module, including “OrRd” and “Spectral”,
come from <a href="http://colorbrewer2.org/">ColorBrewer</a>. You can
take a look at the website and use some of these color palettes in your
plots!</p>
</div>
</div>
<div id="other-data-sources" class="section level2">
<h2>Other Data Sources</h2>
<p>So far in this course you’ve worked with data that we had already
prepared for you. It turns out that there are many R packages and tools
that you can use to get data from a variety of different sources. Below,
we will provide a brief walkthrough of just a few of these
resources.</p>
<div id="lahman" class="section level3">
<h3><code>Lahman</code></h3>
<p>The <a
href="http://www.seanlahman.com/baseball-archive/statistics/">Lahman
Baseball Database</a> is a popular resource created by Sean Lahman with
historical data going back to 1871. Rather than having to access the
database directly via complicated computing procedures, there is an R
package we can install to access the data instead. The following code
installs the package from the CRAN:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;Lahman&quot;</span>)</span></code></pre></div>
<p>Next we load the package, and check out what datasets are
available:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Lahman)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="at">package =</span> <span class="st">&quot;Lahman&quot;</span>)</span></code></pre></div>
<p>There is an incredible amount of data here going up through the 2021
season (it updates following the end of each season). As an example,
let’s access the Teams dataset, use a <code>group_by</code> operation to
calculate the number of strikeouts each year since 1871, and plot the
line over time:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Teams <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(yearID) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_so =</span> <span class="fu">sum</span>(SO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> yearID, <span class="at">y =</span> n_so)) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Number of strikeouts&quot;</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Total number of strikeouts in each baseball season since 1871&quot;</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Data courtesy of Lahman&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="lecture5_files/figure-html/Lahman%20strikeouts%20year-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that rather than supplying the data as an argument to the
<code>ggplot()</code> function, we can start with a dataset, make
manipulations to it using pipes, and then pipe the new data into the
<code>ggplot()</code> function.</p>
<p>We can see the increasing trend over time, but note some of the
outliers like 2020 (pandemic-shortened season) and 1994
(strike-shortened season). How could this display be improved to handle
these outliers, as well as the other gameplay-related changes that have
taken place in baseball?</p>
</div>
<div id="installing-github-packages" class="section level3">
<h3>Installing GitHub Packages</h3>
<p><strong>An important note to keep in mind is that most of these
resources are largely still in development, this means you may face
challenges with installation and use.</strong> While the vast majority
of <code>R</code> packages you will commonly use are able to be
installed using <code>install.packages()</code> because they are on the
CRAN, there are a variety of popular <code>R</code> packages for
accessing sports data that are currently only available through GitHub.
In order to access these packages, we first need to install them using a
package called <code>devtools</code>. The code below installs the
<code>devtools</code> package:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span></code></pre></div>
<p>The <code>devtools</code> package has a function,
<code>install_github</code> that we will use for installing the
remaining packages used below.</p>
</div>
<div id="baseballr" class="section level3">
<h3><code>baseballr</code></h3>
<p>Created by <a href="http://billpetti.github.io/baseballr/">Bill
Petti, the <code>baseballr</code> package</a> has become a popular
resource for accessing baseball data from variety of resources, such
as<a href="https://www.fangraphs.com/">FanGraphs</a> and <a
href="https://www.baseball-reference.com/">Baseball-Reference</a>
directly into <code>R</code>. One of the best features of the
<code>baseballr</code> package is the functionality it provides us for
directly accessing the publicly available pitch-by-pitch and Statcast
data available from <a
href="https://baseballsavant.mlb.com/">baseball-savant</a>.</p>
<p>We first install the package using the <code>devtools</code> package
explained above, and then load its functions:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;BillPetti/baseballr&quot;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(baseballr)</span></code></pre></div>
<p>Using the <code>baseballr</code> package we can access all pitches
thrown to a hitter in the current season, giving us Statcast data like
exit velocity and launch angle. We first use the
<code>playerid_lookup</code> function to find the Statcast ID for
Yankees star (and potential AL MVP) Aaron Judge:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">&quot;Judge&quot;</span>, <span class="at">first_name =</span> <span class="st">&quot;Aaron&quot;</span>)</span></code></pre></div>
<p>This will load up a look-up table with all identifiers joining
various sources together (it may take a couple minutes to run and don’t
worry about the warning messages). We find that Aaron Judge’s unique
<code>mlbam_id</code> is 592450. Using this id, we can grab all pitches
thrown to Judge in the current MLB season so far:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>judge_statcast_data <span class="ot">&lt;-</span> <span class="fu">scrape_statcast_savant_batter</span>(<span class="at">start_date =</span> <span class="st">&quot;2022-01-01&quot;</span>, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">end_date =</span> <span class="st">&quot;2022-12-31&quot;</span>, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">batterid =</span> <span class="dv">592450</span>)</span></code></pre></div>
<p>This dataset contains many columns; for now we will look at the
relationship between the distance traveled of Aaron Judge’s batted balls
(denoted by <code>type == "X"</code>) and the launch angle
(<code>launch_angle</code>) as well as the exit velocity
(<code>launch_speed</code>):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>judge_statcast_data <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;X&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> launch_speed, <span class="at">y =</span> launch_angle, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> hit_distance_sc)) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Exit velocity (MPH)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Launch angle (degrees)&quot;</span>, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Distance (feet)&quot;</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Aaron Judge&#39;s launch angle, exit velocity, and distance traveled&quot;</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Data accessed via baseballr&quot;</span>)</span></code></pre></div>
<p><img src="lecture5_files/figure-html/Judge%20plot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><em>Note that this plot has been updated through July 15th of the
2022 season. Pitches thrown to Judge after this date will not appear on
the above plot.</em></p>
<p>This is just a single example of the type of data available using
<code>baseballr</code>. See the package website for more <a
href="https://billpetti.github.io/baseballr/reference/index.html">data
acquisition functions</a>. Additionally, the <a
href="https://baseballwithr.wordpress.com/">Exploring Baseball Data with
R website by Jim Albert</a> is an incredible resource with a variety of
examples of learning R code all in the context of baseball data
analysis.</p>
</div>
<div id="nbastatr" class="section level3">
<h3><code>nbastatr</code></h3>
<p>The <a href="http://asbcllc.com/nbastatR/"><code>nbastatr</code>
package</a> created by Alex Bresler is analogous to the
<code>baseballr</code> package as it provides many different functions
for accessing NBA data from a variety of websites. Again to be able to
use the package you need to install it from GitHub:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;abresler/nbastatR&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nbastatR)</span></code></pre></div>
<p><strong>There will likely be several messages that appear when
installing this package, please let us know if you encounter any strange
issues.</strong> The code below demonstrates how to get all shot
attempts by the 2022 NBA champions, the Golden State Warriors, in the
past season using this package:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>warriors_shots <span class="ot">&lt;-</span> <span class="fu">teams_shots</span>(<span class="at">teams =</span> <span class="st">&quot;Golden State Warriors&quot;</span>, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seasons =</span> <span class="fu">c</span>(<span class="dv">2022</span>))</span></code></pre></div>
<p>Using this shot data, we can view the all shot attempts by the
Warriors throughout the season colored by whether or not they made the
shot.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>warriors_shots <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> locationX, <span class="at">y =</span> locationY, <span class="at">color =</span> isShotMade)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#FFC72C&quot;</span>, <span class="st">&quot;#1D428A&quot;</span>)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Shot attempts by Golden State Warriors in 2021-22 NBA season&quot;</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Data accessed via nbastatR&quot;</span>)</span></code></pre></div>
<p><img src="lecture5_files/figure-html/Warriors%20shots%20plot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It’s apparent from this chart the effect of the three-point line of
their shot selection.</p>
</div>
<div id="nflfastr" class="section level3">
<h3><code>nflfastR</code></h3>
<p>The <a href="https://www.nflfastr.com/"><code>nflfastR</code>
package</a> gives R users the ability to scrape play-by-play data from
the NFL in real-time during games providing expected points and win
probability estimates. Unlike like the <code>baseballr</code> and
<code>nbastatR</code> packages, the <code>nflfastR</code> package can be
installed the normal way (i.e. without <code>devtools</code>). Lets also
install the <code>ggimage</code> package, which will allow us to plot
the team logos as points.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;nflfastR&quot;</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggimage&quot;</span>)</span></code></pre></div>
<p>Next, we load these packages.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nflfastR)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggimage)</span></code></pre></div>
<p>Now we can use <code>nflfastR</code> to gather play-by-play data for
the 2021 season.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pbp_2021 <span class="ot">&lt;-</span> <span class="fu">load_pbp</span>(<span class="dv">2021</span>)</span></code></pre></div>
<p>With this data, we can summarize the performance of all NFL teams
using the expected points added (EPA) per game on offense and defense.
EPA tells us how much value the team provided relative to an average
baseline. The more positive the better the offensive performance. This
means the more negative the value the defensive performance, so in the
code chunk below we multiply the defensive values by -1 so it’s similar
to offensive performance higher values meaning better performance. The
following code uses this data to create offensive and defensive
summaries that we will join together to plot:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>offense_epa_21 <span class="ot">&lt;-</span> pbp_2021 <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(posteam)) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(posteam) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_games =</span> <span class="fu">length</span>(<span class="fu">unique</span>(game_id)), <span class="at">off_total_epa =</span> <span class="fu">sum</span>(epa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">off_epa_per_game =</span> off_total_epa <span class="sc">/</span> n_games)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>defense_epa_21 <span class="ot">&lt;-</span> pbp_2021 <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(defteam)) <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(defteam) <span class="sc">%&gt;%</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_games =</span> <span class="fu">length</span>(<span class="fu">unique</span>(game_id)), <span class="at">def_total_epa =</span> <span class="fu">sum</span>(epa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This time multiply by -1, since negative values are better for defense:</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">def_epa_per_game =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> def_total_epa <span class="sc">/</span> n_games)</span></code></pre></div>
<p>Next, we join together the offensive and defensive EPA datasets, then
pass this new dataset into <code>ggplot</code>, where we make a plot of
offensive EPA per game vs. defensive EPA per game for all teams in the
2021 season.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data frame to be used for all of the charts:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>offense_epa_21 <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(defense_epa_21, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;posteam&quot;</span> <span class="ot">=</span> <span class="st">&quot;defteam&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(teams_colors_logos, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;posteam&quot;</span> <span class="ot">=</span> <span class="st">&quot;team_abbr&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> off_epa_per_game, <span class="at">y =</span> def_epa_per_game)) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_image</span>(<span class="fu">aes</span>(<span class="at">image =</span> team_logo_espn), <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Offensive EPA per game&quot;</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Defensive EPA per game&quot;</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Data accessed via nflfastR&quot;</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Offensive and defensive EPA per game for each team in the 2021 NFL season&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add reference lines at 0</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="lecture5_files/figure-html/join%20epa%20plot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The top right displays the teams that excelled at both offense and
defense, while the lower right shows teams that had the best offenses
such as the Chiefs but performed poorly on defense. The lower left shows
the worst overall teams, where the Jags, Jets, and Texans unsurprisingly
stand out.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
