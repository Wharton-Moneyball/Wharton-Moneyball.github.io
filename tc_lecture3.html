<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lecture 3: Visualizations with categorical data and grouped operations</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">WMA2020</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-futbol-o"></span>
     
    Lecture Notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lecture1.html">Lecture 1</a>
    </li>
    <li>
      <a href="lecture2.html">Lecture 2</a>
    </li>
    <li>
      <a href="lecture3.html">Lecture 3</a>
    </li>
    <li>
      <a href="lecture4.html">Lecture 4</a>
    </li>
    <li>
      <a href="lecture5.html">Lecture 5</a>
    </li>
    <li>
      <a href="lecture6.html">Lecture 6</a>
    </li>
    <li>
      <a href="lecture7.html">Lecture 7</a>
    </li>
    <li>
      <a href="lecture8.html">Lecture 8</a>
    </li>
    <li>
      <a href="nfl_lecture.html">nflscrapR lecture</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-dribbble"></span>
     
    Problem Sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ps0.html">Problem Set 0</a>
    </li>
    <li>
      <a href="ps1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="ps2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="ps3.html">Problem Set 3</a>
    </li>
    <li>
      <a href="ps4.html">Problem Set 4</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bar-chart"></span>
     
    Training Camp
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="install_setup.html">Installation</a>
    </li>
    <li>
      <a href="tc_lecture1.html">Lecture 1</a>
    </li>
    <li>
      <a href="tc_ps1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="tc_lecture2.html">Lecture 2</a>
    </li>
    <li>
      <a href="tc_ps2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="tc_lecture3.html">Lecture 3</a>
    </li>
    <li>
      <a href="tc_ps3.html">Problem Set 3</a>
    </li>
    <li>
      <a href="tc_lecture4.html">Lecture 4</a>
    </li>
    <li>
      <a href="tc_lecture5.html">Lecture 5</a>
    </li>
    <li>
      <a href="more_resources.html">More resources</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Lecture 3: Visualizations with categorical data and grouped operations</h1>

</div>


<p>We’re going to pick up right where we left off in <a href="tc_lecture2.html">Lecture 2</a> by loading the <code>nba_shooting</code> dataset we created using the <code>filter</code> and <code>mutate</code> functions.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">load</span>(<span class="st">&quot;data/clean_nba_shooting.RData&quot;</span>)</span></code></pre></div>
<p>We’re interested in the rate and efficiency of three-point attempts over time. To start, let’s make simple histograms for <code>three_point_fg_rate = TPA / FGA</code> and <code>TPP</code> following what we learned in <a href="tc_lecture2.html">Lecture 2</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of three-pointer shot rate&quot;</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/tp-rate-hist-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> TPP)) <span class="op">+</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Three-point shot proportion = TPM / TPA&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of three-point shot proportion&quot;</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/tpp-hist-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Next let’s make a scatterplot showing the relationship between the rate at which players attempt three point shots and the proportion at which they make them:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> three_point_fg_rate, <span class="dt">y =</span> TPP)) <span class="op">+</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot proportion = TPM / TPA&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Relationship between three point shot rate and efficiency&quot;</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/tp-scatter-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Unsurprisingly, for the most part we see a random scattering of points. But we can see that players who attempt a minimal proportion of three-point shots for their field goal attempts also have typically low values for their three point shot efficiency. You can expect players that can make three-pointers more often to then attempt more and more three-pointers - but, as the plot shows, they will reach a point where their advantage diminishes.</p>
<div id="plotting-categorical-data" class="section level2">
<h2>Plotting categorical data</h2>
<p>The style of shooting in the NBA has been evolving over the past decade, with teams attempting more and more three-point shots than ever before. We can look into this trend ourselves using the <code>nba_shooting</code> dataset we constructed. Something such as the season/year could be considered like a continuous variable. For instance, we could create a scatterplot with the <code>SEASON</code> variable on the x-axis and each of the variables of interest on the y-axis, such as:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> SEASON, <span class="dt">y =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of three point shot rate each year&quot;</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/season-scatter-tp-rate-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It is hard to see any real differences between the years this way. Instead, we can treat the season as a <strong>categorical variable</strong> to then more appropriately compare the distributions between each year. To do so, we are going to create a new variable in our dataset called <code>season_factor</code> which is simply a new version of the <code>SEASON</code> variable but is converted to a special type of data in <code>R</code> known as a “factor”. We won’t cover the details, but “factors” are essentially categorical variables with an order to them. By default, when we create <code>season_factor</code> using the <code>as.factor()</code> function, the natural chronological order is used.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting &lt;-<span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">season_factor =</span> <span class="kw">as.factor</span>(SEASON))</span></code></pre></div>
<p>Now with this variable, prior to comparing distributions between the different seasons, we will create a <strong>barchart</strong> to compare the number of players we have in each season that met our criteria from <a href="tc_lecture2.html">Lecture 2</a>.</p>
<p>This can be done using <code>geom_bar</code>, and all we have to specify is the categorical variable to be displayed along the x-axis - <code>ggplot</code> will count the number of each player and display it for us just like <code>geom_histogram</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> season_factor)) <span class="op">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_bar</span>() <span class="op">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>, </span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Number of players in each season meeting TPA and FGA cutoffs&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">subtitle =</span> <span class="st">&quot;Excluding lockout seasons 1999 and 2012&quot;</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/season-bars-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>What shouldn’t come as a surprise is that we’re seeing more and more players in more recent years. This makes sense since more players are shooting three-pointers more frequently now.</p>
</div>
<div id="comparing-distributions" class="section level2">
<h2>Comparing distributions</h2>
<p>Now that we have a categorical version of the season to use for plotting, we can proceed to compare the distributions of the three-point stats in a variety of ways.</p>
<p>Naturally you can make <strong>multiple</strong> histograms to compare the distributions of several different categories with simple extensions of code you are already familiar with. This can be done in several different ways.</p>
<div id="facets" class="section level3">
<h3>Facets</h3>
<p>We can use <em>facets</em> to create histograms for each different season. Facets allow you to separate graphs by category. We do not need to do anything different from our above code for creating histograms except we only need to add a <em>facet</em> layer to our graph. The first argument of <code>facet_wrap</code> is the column of our dataset that contains the category information. Note that we need a tilde (<code>~</code>) in front of <code>season_factor</code>. The second argument of <code>facet_wrap</code> specifies the number of rows for which to display the graphs.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of 3PT shot rate by season&quot;</span>) <span class="op">+</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="op">+</span><span class="st">   </span><span class="kw">facet_wrap</span>(<span class="op">~</span>season_factor, <span class="dt">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/facet-hist-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Although we can now see a histogram of three-point shot rate for each separate season, it’s a little hard to make comparisons across all the years.</p>
</div>
<div id="colors" class="section level3">
<h3>Colors</h3>
<p>We can also proceed to create multiple histograms using colors instead of facets, by just adding the <code>fill = season_factor</code> line to the <code>aes</code> function. <strong>NOTE</strong>: it’s important to remember the difference between <code>fill</code> and <code>color</code>. In this case, <code>fill</code> actually changes the literal <em>fill</em> of the bars while <code>color</code> changes the line. This differs from <code>geom_point</code> and is important to keep in mind when making plots.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> three_point_fg_rate, <span class="dt">fill =</span> season_factor)) <span class="op">+</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">fill =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of 3PT shot rate by season&quot;</span>) </span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/hist-color-stacked-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Well that’s a weird looking plot! This is because by default the multiple histograms will be stacked on top of one another. We can instead change the <code>position</code> of the <code>geom_histogram</code> call to be equal to “identity” rather than the default which is “stacked”. When doing this we’ll have several histograms overlaid on top of each other, so it’s important to change the <code>alpha</code> to be a lower value.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> three_point_fg_rate, <span class="dt">fill =</span> season_factor)) <span class="op">+</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.05</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="op">+</span><span class="st">                  </span><span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="op">+</span><span class="st">        </span><span class="dt">fill =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of 3PT shot rate by season&quot;</span>) </span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/hist-color-dodge-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Overall this is still a rather difficult figure to digest. Instead, we should make figures that take advantage of the natural ordering implied by the season along an axis while displying various comparisons of the distributions.</p>
</div>
<div id="boxplots" class="section level3">
<h3>Boxplots</h3>
<p>By far the simplest way to compare distributions across many levels of a categorical variable is with boxplots. Side-by-side boxplots can be generated easily using <code>geom_boxplot</code>. Now we specify the categorical variable we want <strong>mapped</strong> to the x-axis (<code>season_factor</code>) and then the variable we want mapped to the y-axis.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Comparison of 3PT shot rate for each season with boxplots&quot;</span>) </span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/boxplot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Remember, boxplots are displaying summary statistics (median, min, max, and percentiles) which allows us to easily see an increase in the median three-point shot rate over time. <strong>But boxplots are extremely limited visualizations!</strong> All they provide are summary statistics - think of all the information we observed in histograms that are lost in boxplots! There is no way of knowing if we’re looking at distributions with multiple modes!</p>
</div>
<div id="violin-plots" class="section level3">
<h3>Violin plots</h3>
<p>A much more informative plot than only a boxplot, is a <strong>violin plot</strong>. Violin plots display the density curves giving us the general shape of a distribution. And of course, there’s a <code>geom</code> for that as well called… <code>geom_violin</code>!</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_violin</span>() <span class="op">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Comparison of 3PT shot rate for each season with violin plots&quot;</span>) </span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/violin-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This gives us a sense of the distributions in each season, and any sort of subtle differences over time. What’s missing from this plot is the key points provided by boxplots to show the increasing rate of three point attempts. Because we are using <code>ggplot</code>, we can easily add the boxplot layer on top of the violin plots to get the best of both visualizations! We just specify a small <code>width</code> for our boxplots so that they don’t take up too much space and fit inside the violin plots.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_violin</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_boxplot</span>(<span class="dt">width =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Comparison of 3PT shot rate for each season with violin and boxplots&quot;</span>) </span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/violin-box-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="ridgeplots" class="section level3">
<h3>Ridgeplots</h3>
<p>Many people often find violin plots hard to look at, and this has led to the development of another curve-based approach known as <strong>ridge plots</strong>. Ridge plots are often used to view the change in distributions over time, especially with a large number of years considered such as the example here. In order to make ridge plots, we need to install an additional package: <a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html"><code>ggridges</code></a>. With this package installed, we can now access it and use what appears to be a slightly different mapping then boxplots and violin plots:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># install.packages(&quot;ggridges&quot;)</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggridges)</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> three_point_fg_rate, <span class="dt">y =</span> season_factor)) <span class="op">+</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_density_ridges</span>() <span class="op">+</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="op">+</span><span class="st">        </span><span class="dt">x =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Comparison of 3PT shot rate for each season with ridges&quot;</span>) </span>
<span id="cb14-10"><a href="#cb14-10"></a>Picking joint bandwidth of <span class="fl">0.0435</span></span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/ridges-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The code above is similar to <code>geom_histogram</code> but now maps the y-axis to a variable for separating the distributions. The idea is it eliminates the redundancy in the symmetry of violin plots by just displaying one side of the curve. We can see a slight shift taking place over time to higher 3PT shot rates.</p>
</div>
<div id="beeswarm-plots" class="section level3">
<h3>Beeswarm plots</h3>
<p><strong>Beeswarm plots</strong> are the final type of plot we’ll consider for comparing distributions. Again in order to create beeswarm plots, we need to install an additional package: <a href="https://cran.r-project.org/web/packages/ggbeeswarm/vignettes/usageExamples.pdf"><code>ggbeeswarm</code></a>. Beeswarm plots display the distributions for each category by <strong>plotting all of the individual data points</strong> with the placement resembling the histogram and density curve shape.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># install.packages(&quot;ggbeeswarm&quot;)</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggbeeswarm)</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_quasirandom</span>(<span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Comparison of 3PT shot rate for each season with beeswarms&quot;</span>) </span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/beeswarm-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="group-by-and-summarize" class="section level2">
<h2>Group by and summarize</h2>
<p>Very often in a data analysis, instead of performing a calculation on the entire data set, you’ll want to first <em>split</em> the data into smaller subsets, <em>apply</em> the same calculation on every subset, and then <em>combine</em> the results from each subset. For example, in order to calculate the <strong>average</strong> three-point shot rate <strong>for each season</strong>, we need to split our dataset based on the season, compute the average three-point shot rate, and combine back into a single dataset.</p>
<p>We can easily implement this “split-apply-combine” paradigm using the function <code>group_by()</code>. Let’s now modify the <code>nba_shooting</code> data so that the years belonging to the same season are grouped together.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting &lt;-<span class="st"> </span>nba_shooting <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(season_factor)</span></code></pre></div>
<p>When we print out <code>nba_shooting</code> now, we notice an extra line that tells us the grouping variable. Now when we pass this <code>tbl</code> on to subsequent calculations, these calculations will be done on each group.</p>
<p>We can now summarize each season using another <code>tidyverse</code> function called… <code>summarize()</code>! This convenient function will compute summary statistics that we specify with respect to the groups from <code>group_by()</code>. For instance, we can compute the average three-point shot rate for each season in the following way:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">ave_tp_shot_rate =</span> <span class="kw">mean</span>(three_point_fg_rate))</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="st">`</span><span class="dt">summarise()</span><span class="st">`</span> ungrouping <span class="kw">output</span> (override with <span class="st">`</span><span class="dt">.groups</span><span class="st">`</span> argument)</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co"># A tibble: 18 x 2</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>   season_factor ave_tp_shot_rate</span>
<span id="cb17-6"><a href="#cb17-6"></a>   <span class="op">&lt;</span>fct<span class="op">&gt;</span><span class="st">                    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="st"> </span><span class="dv">1</span> <span class="dv">1997</span>                     <span class="fl">0.345</span></span>
<span id="cb17-8"><a href="#cb17-8"></a> <span class="dv">2</span> <span class="dv">1998</span>                     <span class="fl">0.288</span></span>
<span id="cb17-9"><a href="#cb17-9"></a> <span class="dv">3</span> <span class="dv">2000</span>                     <span class="fl">0.300</span></span>
<span id="cb17-10"><a href="#cb17-10"></a> <span class="dv">4</span> <span class="dv">2001</span>                     <span class="fl">0.295</span></span>
<span id="cb17-11"><a href="#cb17-11"></a> <span class="dv">5</span> <span class="dv">2002</span>                     <span class="fl">0.305</span></span>
<span id="cb17-12"><a href="#cb17-12"></a> <span class="dv">6</span> <span class="dv">2003</span>                     <span class="fl">0.295</span></span>
<span id="cb17-13"><a href="#cb17-13"></a> <span class="dv">7</span> <span class="dv">2004</span>                     <span class="fl">0.309</span></span>
<span id="cb17-14"><a href="#cb17-14"></a> <span class="dv">8</span> <span class="dv">2005</span>                     <span class="fl">0.310</span></span>
<span id="cb17-15"><a href="#cb17-15"></a> <span class="dv">9</span> <span class="dv">2006</span>                     <span class="fl">0.319</span></span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="dv">10</span> <span class="dv">2007</span>                     <span class="fl">0.341</span></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="dv">11</span> <span class="dv">2008</span>                     <span class="fl">0.334</span></span>
<span id="cb17-18"><a href="#cb17-18"></a><span class="dv">12</span> <span class="dv">2009</span>                     <span class="fl">0.339</span></span>
<span id="cb17-19"><a href="#cb17-19"></a><span class="dv">13</span> <span class="dv">2010</span>                     <span class="fl">0.341</span></span>
<span id="cb17-20"><a href="#cb17-20"></a><span class="dv">14</span> <span class="dv">2011</span>                     <span class="fl">0.361</span></span>
<span id="cb17-21"><a href="#cb17-21"></a><span class="dv">15</span> <span class="dv">2013</span>                     <span class="fl">0.375</span></span>
<span id="cb17-22"><a href="#cb17-22"></a><span class="dv">16</span> <span class="dv">2014</span>                     <span class="fl">0.373</span></span>
<span id="cb17-23"><a href="#cb17-23"></a><span class="dv">17</span> <span class="dv">2015</span>                     <span class="fl">0.390</span></span>
<span id="cb17-24"><a href="#cb17-24"></a><span class="dv">18</span> <span class="dv">2016</span>                     <span class="fl">0.373</span></span></code></pre></div>
<p>The following functions are quite useful for summarizing several aspects of the distribution of the variables in our dataset:</p>
<ul>
<li>Center: <code>mean()</code>, <code>median()</code></li>
<li>Spread: <code>sd()</code>, <code>IQR()</code></li>
<li>Range: <code>min()</code>, <code>max()</code></li>
<li>Count: <code>n()</code>, <code>n_distinct()</code></li>
</ul>
<p>Now we’ll make a dataset that provides us with both the mean and <strong>standard deviation</strong> of three-point shot rate within each year, storing it as <code>nba_shooting_summary</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting_summary &lt;-<span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">ave_tp_shot_rate =</span> <span class="kw">mean</span>(three_point_fg_rate),</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="op">+</span><span class="st">             </span><span class="dt">sd_tp_shot_rate =</span> <span class="kw">sd</span>(three_point_fg_rate))</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="st">`</span><span class="dt">summarise()</span><span class="st">`</span> ungrouping <span class="kw">output</span> (override with <span class="st">`</span><span class="dt">.groups</span><span class="st">`</span> argument)</span></code></pre></div>
<p>With this dataset, we are now going to create a plot that shows the average three-point shot rate each year, along with <strong>error bars</strong> to represent plus-or-minus one standard deviation. We’ll use <code>geom_point</code> to plot the average, then display an interval with <code>geom_errorbar</code>. Now we’re going to do something a little different for this plot, since we’re using multiple <code>geom</code>s we will set the <code>aes</code> separately rather than in the <code>ggplot</code> call like before for the settings that are unique to <code>geom_errorbar</code>. Both <code>geom_point</code> and and <code>geom_errorbar</code> will share the same <code>x</code> axis though so that will be assigned in the <code>ggplot</code> line:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting_summary <span class="op">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> season_factor)) <span class="op">+</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ave_tp_shot_rate)) <span class="op">+</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> ave_tp_shot_rate <span class="op">-</span><span class="st"> </span>sd_tp_shot_rate,</span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="op">+</span><span class="st">                     </span><span class="dt">ymax =</span> ave_tp_shot_rate <span class="op">+</span><span class="st"> </span>sd_tp_shot_rate)) <span class="op">+</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Average three point shot rate with +/- 1 standard deviation&quot;</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/three-point-errors-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>And one of the best parts of using <code>ggplot</code> is that we can take this code, and <strong>add</strong> it to our previous code - such as the violin plots or beeswarm plots. All we have to do is specify the dataset to use for each <code>geom</code> separately now, rather than piping the whole dataset into the operation:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Start with blank canvas:</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="op">+</span><span class="st">   </span><span class="co"># Now add the violin plot layer:</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_violin</span>(<span class="dt">data =</span> nba_shooting,</span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="op">+</span><span class="st">               </span><span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="op">+</span><span class="st">   </span><span class="co"># Next the layers for the average and error bars:</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">data =</span> nba_shooting_summary,</span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="op">+</span><span class="st">              </span><span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> ave_tp_shot_rate),</span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="op">+</span><span class="st">              </span><span class="co"># Let&#39;s make this red on top:</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="op">+</span><span class="st">              </span><span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_errorbar</span>(<span class="dt">data =</span> nba_shooting_summary,</span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="op">+</span><span class="st">                 </span><span class="kw">aes</span>(<span class="dt">x =</span> season_factor, </span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="op">+</span><span class="st">                     </span><span class="dt">ymin =</span> ave_tp_shot_rate <span class="op">-</span><span class="st"> </span>sd_tp_shot_rate,</span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="op">+</span><span class="st">                     </span><span class="dt">ymax =</span> ave_tp_shot_rate <span class="op">+</span><span class="st"> </span>sd_tp_shot_rate),</span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="op">+</span><span class="st">                 </span><span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of 3PT shot rate for each season&quot;</span>,</span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="op">+</span><span class="st">        </span><span class="dt">subtitle =</span> <span class="st">&quot;Red points indicate average for each year with +/- 1 standard deviation&quot;</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/violin-errorbars-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># Start with blank canvas:</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="op">+</span><span class="st">   </span><span class="co"># Now add the beeswarm plot layer:</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_quasirandom</span>(<span class="dt">data =</span> nba_shooting,</span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="op">+</span><span class="st">                    </span><span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> three_point_fg_rate),</span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="op">+</span><span class="st">                    </span><span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="op">+</span><span class="st">   </span><span class="co"># Next the layers for the average and error bars:</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">data =</span> nba_shooting_summary,</span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="op">+</span><span class="st">              </span><span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> ave_tp_shot_rate),</span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="op">+</span><span class="st">              </span><span class="co"># Let&#39;s make this red on top:</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="op">+</span><span class="st">              </span><span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_errorbar</span>(<span class="dt">data =</span> nba_shooting_summary,</span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="op">+</span><span class="st">                 </span><span class="kw">aes</span>(<span class="dt">x =</span> season_factor, </span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="op">+</span><span class="st">                     </span><span class="dt">ymin =</span> ave_tp_shot_rate <span class="op">-</span><span class="st"> </span>sd_tp_shot_rate,</span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="op">+</span><span class="st">                     </span><span class="dt">ymax =</span> ave_tp_shot_rate <span class="op">+</span><span class="st"> </span>sd_tp_shot_rate),</span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="op">+</span><span class="st">                 </span><span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb21-18"><a href="#cb21-18"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of 3PT shot rate for each season&quot;</span>,</span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="op">+</span><span class="st">        </span><span class="dt">subtitle =</span> <span class="st">&quot;Red points indicate average for each year with +/- 1 standard deviation&quot;</span>)</span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/beeswarm-errorbars-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>You probably noticed that the first season in the dataset (labeled 1997 but corresponds to 1996-1997) has a higher three-point shot rate than other earlier years. As it turns out, this was the last year of a closer three-point line! The NBA experimented with a closer three-point line for three years before moving it back to the original location in the 1997-1998 season (labeled 1998 in our dataset).</p>
<p>We can now <code>ungroup</code> our dataset since we’re done with this operation:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting &lt;-<span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ungroup</span>()</span></code></pre></div>
<p>To end today’s lecture, we could have used the following code instead as a shortcut for displaying the averages and standard deviation bars.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="op">&gt;</span><span class="st"> </span>nba_shooting <span class="op">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> season_factor, <span class="dt">y =</span> three_point_fg_rate)) <span class="op">+</span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_violin</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="op">+</span><span class="st">   </span><span class="co"># Now add a summary layer:</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">stat_summary</span>(<span class="dt">fun.data =</span> <span class="st">&quot;mean_sdl&quot;</span>,</span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="op">+</span><span class="st">                </span><span class="dt">fun.args =</span> <span class="kw">list</span>(<span class="dt">mult =</span> <span class="dv">1</span>),</span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="op">+</span><span class="st">                </span><span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="op">+</span><span class="st">   </span><span class="co"># label!</span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Season&quot;</span>,</span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="op">+</span><span class="st">        </span><span class="dt">y =</span> <span class="st">&quot;Three-point shot rate = TPA / FGA&quot;</span>,</span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="op">+</span><span class="st">        </span><span class="dt">title =</span> <span class="st">&quot;Distribution of 3PT shot rate for each season&quot;</span>,</span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="op">+</span><span class="st">        </span><span class="dt">subtitle =</span> <span class="st">&quot;Red points indicate average for each year with +/- 1 standard deviation&quot;</span>)</span>
<span id="cb23-13"><a href="#cb23-13"></a>Warning<span class="op">:</span><span class="st"> </span>Computation failed <span class="cf">in</span> <span class="st">`</span><span class="dt">stat_summary()</span><span class="st">`</span><span class="op">:</span></span>
<span id="cb23-14"><a href="#cb23-14"></a>Hmisc package required <span class="cf">for</span> this <span class="cf">function</span></span></code></pre></div>
<p><img src="tc_lecture3_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This is a completely different style of plotting than you have seen before, but it is extremely convenient since we don’t need to create a separate dataset to display summaries of the data. The <code>fun.data</code> part is asking for a type of summary, where here we are using the mean and standard deviation summary indicated by <code>mean_sdl</code>. Then the <code>fun.args</code> is taking the multiplier for the standard deviation interval.</p>
<p>Now spend time going through this lecture and repeat the same type of analysis for TPP in <a href="tc_ps3.html">Problem Set 3</a>.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
