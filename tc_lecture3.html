<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lecture 3: Visualizations with categorical data and grouped operations</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>










<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><img id="logo" style="width: 200px;" src="figures/WMA_logo.png" /></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-sign-in"></span>
     
    Get Started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lecture0.html">Lecture 0</a>
    </li>
    <li>
      <a href="ps0.html">Problem Set 0</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-institution"></span>
     
    Academy
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lecture1.html">Lecture 1</a>
    </li>
    <li>
      <a href="lecture2.html">Lecture 2</a>
    </li>
    <li>
      <a href="lecture3.html">Lecture 3</a>
    </li>
    <li>
      <a href="lecture4.html">Lecture 4</a>
    </li>
    <li>
      <a href="lecture5.html">Lecture 5</a>
    </li>
    <li>
      <a href="lecture6.html">Lecture 6</a>
    </li>
    <li>
      <a href="lecture7.html">Lecture 7</a>
    </li>
    <li>
      <a href="lecture8.html">Lecture 8</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="ps1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="ps2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="ps3.html">Problem Set 3</a>
    </li>
    <li>
      <a href="ps4.html">Problem Set 4</a>
    </li>
    <li>
      <a href="ps5.html">Problem Set 5</a>
    </li>
    <li>
      <a href="ps6.html">Problem Set 6</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="lecture_nflscrapR.html">nflscrapR Lecture</a>
    </li>
    <li>
      <a href="psX.html">Problem Set X</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-dribbble"></span>
     
    Training Camp
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="tc_lecture1.html">Lecture 1</a>
    </li>
    <li>
      <a href="tc_lecture2.html">Lecture 2</a>
    </li>
    <li>
      <a href="tc_lecture3.html">Lecture 3</a>
    </li>
    <li>
      <a href="tc_lecture4.html">Lecture 4</a>
    </li>
    <li>
      <a href="tc_lecture5.html">Lecture 5</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="tc_ps1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="tc_ps2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="tc_ps3.html">Problem Set 3</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="tc_lecture_data_sources.html">Data Sources Lecture</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Lecture 3: Visualizations with categorical
data and grouped operations</h1>

</div>


<p>We’re going to pick up right where we left off in <a
href="tc_lecture2.html">Lecture 2</a> by loading the
<code>nba_shooting</code> dataset we created using the
<code>filter</code> and <code>mutate</code> functions.</p>
<p>We’re interested in the rate and efficiency of three-point attempts
over time. To start, let’s make simple histograms for
<code>three_point_fg_rate = TPA / FGA</code> and <code>TPP</code>
following what we learned in <a href="tc_lecture2.html">Lecture
2</a>.</p>
<p>Next let’s make a scatterplot showing the relationship between the
rate at which players attempt three point shots and the proportion at
which they make them:</p>
<p>Unsurprisingly, for the most part we see a random scattering of
points. But we can see that players who attempt a minimal proportion of
three-point shots for their field goal attempts also have typically low
values for their three point shot efficiency. You can expect players
that can make three-pointers more often to then attempt more and more
three-pointers - but, as the plot shows, they will reach a point where
their advantage diminishes.</p>
<div id="plotting-categorical-data" class="section level2">
<h2>Plotting categorical data</h2>
<p>The style of shooting in the NBA has been evolving over the past
decade, with teams attempting more and more three-point shots than ever
before. We can look into this trend ourselves using the
<code>nba_shooting</code> dataset we constructed. Something such as the
season/year could be considered like a continuous variable. For
instance, we could create a scatterplot with the <code>SEASON</code>
variable on the x-axis and each of the variables of interest on the
y-axis, such as:</p>
<p>It is hard to see any real differences between the years this way.
Instead, we can treat the season as a <strong>categorical
variable</strong> to then more appropriately compare the distributions
between each year. To do so, we are going to create a new variable in
our dataset called <code>season_factor</code> which is simply a new
version of the <code>SEASON</code> variable but is converted to a
special type of data in <code>R</code> known as a “factor”. We won’t
cover the details, but “factors” are essentially categorical variables
with an order to them. By default, when we create
<code>season_factor</code> using the <code>as.factor()</code> function,
the natural chronological order is used.</p>
<p>Now with this variable, prior to comparing distributions between the
different seasons, we will create a <strong>barchart</strong> to compare
the number of players we have in each season that met our criteria from
<a href="tc_lecture2.html">Lecture 2</a>.</p>
<p>This can be done using <code>geom_bar</code>, and all we have to
specify is the categorical variable to be displayed along the x-axis -
<code>ggplot</code> will count the number of each player and display it
for us just like <code>geom_histogram</code>.</p>
<p>What shouldn’t come as a surprise is that we’re seeing more and more
players in more recent years. This makes sense since more players are
shooting three-pointers more frequently now.</p>
</div>
<div id="comparing-distributions" class="section level2">
<h2>Comparing distributions</h2>
<p>Now that we have a categorical version of the season to use for
plotting, we can proceed to compare the distributions of the three-point
stats in a variety of ways.</p>
<p>Naturally you can make <strong>multiple</strong> histograms to
compare the distributions of several different categories with simple
extensions of code you are already familiar with. This can be done in
several different ways.</p>
<div id="facets" class="section level3">
<h3>Facets</h3>
<p>We can use <em>facets</em> to create histograms for each different
season. Facets allow you to separate graphs by category. We do not need
to do anything different from our above code for creating histograms
except we only need to add a <em>facet</em> layer to our graph. The
first argument of <code>facet_wrap</code> is the column of our dataset
that contains the category information. Note that we need a tilde
(<code>~</code>) in front of <code>season_factor</code>. The second
argument of <code>facet_wrap</code> specifies the number of rows for
which to display the graphs.</p>
<p>Although we can now see a histogram of three-point shot rate for each
separate season, it’s a little hard to make comparisons across all the
years.</p>
</div>
<div id="colors" class="section level3">
<h3>Colors</h3>
<p>We can also proceed to create multiple histograms using colors
instead of facets, by just adding the <code>fill = season_factor</code>
line to the <code>aes</code> function. <strong>NOTE</strong>: it’s
important to remember the difference between <code>fill</code> and
<code>color</code>. In this case, <code>fill</code> actually changes the
literal <em>fill</em> of the bars while <code>color</code> changes the
line. This differs from <code>geom_point</code> and is important to keep
in mind when making plots.</p>
<p>Well that’s a weird looking plot! This is because by default the
multiple histograms will be stacked on top of one another. We can
instead change the <code>position</code> of the
<code>geom_histogram</code> call to be equal to “identity” rather than
the default which is “stacked”. When doing this we’ll have several
histograms overlaid on top of each other, so it’s important to change
the <code>alpha</code> to be a lower value.</p>
<p>Overall this is still a rather difficult figure to digest. Instead,
we should make figures that take advantage of the natural ordering
implied by the season along an axis while displying various comparisons
of the distributions.</p>
</div>
<div id="boxplots" class="section level3">
<h3>Boxplots</h3>
<p>By far the simplest way to compare distributions across many levels
of a categorical variable is with boxplots. Side-by-side boxplots can be
generated easily using <code>geom_boxplot</code>. Now we specify the
categorical variable we want <strong>mapped</strong> to the x-axis
(<code>season_factor</code>) and then the variable we want mapped to the
y-axis.</p>
<p>Remember, boxplots are displaying summary statistics (median, min,
max, and percentiles) which allows us to easily see an increase in the
median three-point shot rate over time. <strong>But boxplots are
extremely limited visualizations!</strong> All they provide are summary
statistics - think of all the information we observed in histograms that
are lost in boxplots! There is no way of knowing if we’re looking at
distributions with multiple modes!</p>
</div>
<div id="violin-plots" class="section level3">
<h3>Violin plots</h3>
<p>A much more informative plot than only a boxplot, is a <strong>violin
plot</strong>. Violin plots display the density curves giving us the
general shape of a distribution. And of course, there’s a
<code>geom</code> for that as well called… <code>geom_violin</code>!</p>
<p>This gives us a sense of the distributions in each season, and any
sort of subtle differences over time. What’s missing from this plot is
the key points provided by boxplots to show the increasing rate of three
point attempts. Because we are using <code>ggplot</code>, we can easily
add the boxplot layer on top of the violin plots to get the best of both
visualizations! We just specify a small <code>width</code> for our
boxplots so that they don’t take up too much space and fit inside the
violin plots.</p>
</div>
<div id="ridgeplots" class="section level3">
<h3>Ridgeplots</h3>
<p>Many people often find violin plots hard to look at, and this has led
to the development of another curve-based approach known as
<strong>ridge plots</strong>. Ridge plots are often used to view the
change in distributions over time, especially with a large number of
years considered such as the example here. In order to make ridge plots,
we need to install an additional package: <a
href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html"><code>ggridges</code></a>.
With this package installed, we can now access it and use what appears
to be a slightly different mapping then boxplots and violin plots:</p>
<p>The code above is similar to <code>geom_histogram</code> but now maps
the y-axis to a variable for separating the distributions. The idea is
it eliminates the redundancy in the symmetry of violin plots by just
displaying one side of the curve. We can see a slight shift taking place
over time to higher 3PT shot rates.</p>
</div>
<div id="beeswarm-plots" class="section level3">
<h3>Beeswarm plots</h3>
<p><strong>Beeswarm plots</strong> are the final type of plot we’ll
consider for comparing distributions. Again in order to create beeswarm
plots, we need to install an additional package: <a
href="https://cran.r-project.org/web/packages/ggbeeswarm/vignettes/usageExamples.pdf"><code>ggbeeswarm</code></a>.
Beeswarm plots display the distributions for each category by
<strong>plotting all of the individual data points</strong> with the
placement resembling the histogram and density curve shape.</p>
</div>
</div>
<div id="group-by-and-summarize" class="section level2">
<h2>Group by and summarize</h2>
<p>Very often in a data analysis, instead of performing a calculation on
the entire data set, you’ll want to first <em>split</em> the data into
smaller subsets, <em>apply</em> the same calculation on every subset,
and then <em>combine</em> the results from each subset. For example, in
order to calculate the <strong>average</strong> three-point shot rate
<strong>for each season</strong>, we need to split our dataset based on
the season, compute the average three-point shot rate, and combine back
into a single dataset.</p>
<p>We can easily implement this “split-apply-combine” paradigm using the
function <code>group_by()</code>. Let’s now modify the
<code>nba_shooting</code> data so that the years belonging to the same
season are grouped together.</p>
<p>When we print out <code>nba_shooting</code> now, we notice an extra
line that tells us the grouping variable. Now when we pass this
<code>tbl</code> on to subsequent calculations, these calculations will
be done on each group.</p>
<p>We can now summarize each season using another <code>tidyverse</code>
function called… <code>summarize()</code>! This convenient function will
compute summary statistics that we specify with respect to the groups
from <code>group_by()</code>. For instance, we can compute the average
three-point shot rate for each season in the following way:</p>
<p>The following functions are quite useful for summarizing several
aspects of the distribution of the variables in our dataset:</p>
<ul>
<li>Center: <code>mean()</code>, <code>median()</code></li>
<li>Spread: <code>sd()</code>, <code>IQR()</code></li>
<li>Range: <code>min()</code>, <code>max()</code></li>
<li>Count: <code>n()</code>, <code>n_distinct()</code></li>
</ul>
<p>Now we’ll make a dataset that provides us with both the mean and
<strong>standard deviation</strong> of three-point shot rate within each
year, storing it as <code>nba_shooting_summary</code>:</p>
<p>With this dataset, we are now going to create a plot that shows the
average three-point shot rate each year, along with <strong>error
bars</strong> to represent plus-or-minus one standard deviation. We’ll
use <code>geom_point</code> to plot the average, then display an
interval with <code>geom_errorbar</code>. Now we’re going to do
something a little different for this plot, since we’re using multiple
<code>geom</code>s we will set the <code>aes</code> separately rather
than in the <code>ggplot</code> call like before for the settings that
are unique to <code>geom_errorbar</code>. Both <code>geom_point</code>
and and <code>geom_errorbar</code> will share the same <code>x</code>
axis though so that will be assigned in the <code>ggplot</code>
line:</p>
<p>And one of the best parts of using <code>ggplot</code> is that we can
take this code, and <strong>add</strong> it to our previous code - such
as the violin plots or beeswarm plots. All we have to do is specify the
dataset to use for each <code>geom</code> separately now, rather than
piping the whole dataset into the operation:</p>
<p>You probably noticed that the first season in the dataset (labeled
1997 but corresponds to 1996-1997) has a higher three-point shot rate
than other earlier years. As it turns out, this was the last year of a
closer three-point line! The NBA experimented with a closer three-point
line for three years before moving it back to the original location in
the 1997-1998 season (labeled 1998 in our dataset).</p>
<p>We can now <code>ungroup</code> our dataset since we’re done with
this operation:</p>
<p>To end today’s lecture, we could have used the following code instead
as a shortcut for displaying the averages and standard deviation
bars.</p>
<p>This is a completely different style of plotting than you have seen
before, but it is extremely convenient since we don’t need to create a
separate dataset to display summaries of the data. The
<code>fun.data</code> part is asking for a type of summary, where here
we are using the mean and standard deviation summary indicated by
<code>mean_sdl</code>. Then the <code>fun.args</code> is taking the
multiplier for the standard deviation interval.</p>
<p>Now spend time going through this lecture and repeat the same type of
analysis for TPP in <a href="tc_ps3.html">Problem Set 3</a>.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
