<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lecture 2: Visualization and More Data Wrangling</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">WMb'22</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-institution"></span>
     
    Academy
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lecture0.html">Lecture 0</a>
    </li>
    <li class="dropdown-header">Problem Set 0</li>
    <li>
      <a href="tc_lecture0.html">Lecture 0</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-dribbble"></span>
     
    Training Camp
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="tc_lecture0.html">Lecture 0</a>
    </li>
    <li>
      <a href="tc_lecture1.html">Lecture 1</a>
    </li>
    <li>
      <a href="tc_ps1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="tc_lecture2.html">Lecture 2</a>
    </li>
    <li>
      <a href="tc_ps2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="tc_lecture3.html">Lecture 3</a>
    </li>
    <li>
      <a href="tc_ps3.html">Problem Set 3</a>
    </li>
    <li>
      <a href="tc_lecture4.html">Lecture 4</a>
    </li>
    <li>
      <a href="tc_lecture5.html">Lecture 5</a>
    </li>
    <li>
      <a href="more_resources.html">More resources</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lecture 2: Visualization and More Data
Wrangling</h1>

</div>


<p>We’re going to pick up right where we left off yesterday in <a
href="ps1.html">Problem Set 1</a>, where you wrote a script to create a
tbl containg several shooting statistics for NBA players between the
1996-97 season and the 2015-16 season. Your script should look something
like what is the code block below. For reasons that will become clear
shortly, we are going to call our tbl <code>raw_shooting</code>.</p>
<pre class="r"><code>&gt; library(tidyverse)
&gt; raw_shooting &lt;- read_csv(file = &quot;data/nba_shooting.csv&quot;)
Rows: 7447 Columns: 8
── Column specification ────────────────────────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
chr (1): PLAYER
dbl (7): SEASON, FGM, FGA, TPM, TPA, FTM, FTA

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
&gt; raw_shooting &lt;-
+   mutate(raw_shooting,
+          FGP = FGM/FGA,
+          TPP = TPM/TPA,
+          FTP = FTM/FTA,
+          eFGP = (FGM + 0.5 * TPM)/(FGA),
+          PTS = FTM + 2 * FGM + TPM,
+          TSP = PTS/(2 * (FGA + 0.44 * FTA)))
&gt; nba_shooting &lt;- arrange(raw_shooting, desc(TSP))</code></pre>
<p>We will use visualization to answer some questions about the data.
Specifically, we will study the distribution of the individual columns
as well as try to understand the relationship between pairs of
variables. For instance, is a player’s free throw percentage predictive
of his three point percentage?</p>
<p>To produce graphics throughout this course, we will use ggplot2,
which is a package contained in the tidyverse. At a very high level,
ggplot2 works by layering graphics, adding different features one on top
of another. You can learn much much more about ggplot2 <a
href="https://ggplot2.tidyverse.org">here</a>. We will cover some of the
more advanced functionality of ggplot2 in</p>
<div id="histograms" class="section level3">
<h3>Histograms</h3>
<p>As you saw in Prof. Wyner’s lectures, histograms are a powerful way
to describe a single dataset.</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + 
+   geom_histogram(mapping = aes(x = FGP), bins = 5)</code></pre>
<p><img src="lecture2_files/figure-html/fgp-histogram-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The first bit of the code above,
<code>ggplot(data = nba_shooting)</code> tells R to create a coordinate
system to which can add additional layers. It also tells R that the data
to be plotted is coming from the tibble <code>nba_shooting</code>. The
next part of the code,
<code>+ geom_histogram(mapping = aes(FGP), bins = 5)</code> tells R to
<em>add</em> a layer to the blank plot, in this case a histogram of
field goal percentage that uses 5 bins. The first argument is the
mapping, which defines how each variable in our dataset is mapped to
visual components of the graph (the <em>aesthetics</em>) In the case of
a histogram, we really only need to tell R that the variable we want to
visualize goes on the horizontal (x) axis. To improve readability, we
have divided the code to produce the historgram over two lines.
<strong>It is very important when using ggplot to have the + sign at the
end of the line.</strong></p>
<p>In the code above, we also told R how many bins into which to divide
the data. We can vary the number of bins to get a higher-resolution view
of our data. For instance, we can use 50 bins:
<img src="lecture2_files/figure-html/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Instead of specifying the number of bins, which can sometimes be
difficult, we could instead specify the width of the bins. For instance,
we could split our data into bins of width 0.05 as follows:</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + geom_histogram(mapping = aes(x = FGP), binwidth = 0.05)</code></pre>
<p><img src="lecture2_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It is often preferable to use a density histogram instead of a
frequency histogram. This is because the areas of the density histogram
boxes always sums to 1 no matter how much data you have.</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + geom_histogram(mapping = aes(x = FGP, y = ..density..), bins = 50)</code></pre>
<p><img src="lecture2_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" />
Visually, the histograms look identical but now the vertical (y) axis
has a different scale.</p>
<!--**Exercise** Make histograms of FGA, FTA, TPA, FTP, and TPP. Comment on the differences-->
</div>
<div id="visualizing-bivariate-data" class="section level3">
<h3>Visualizing bivariate data</h3>
<p>While examining one variable (i.e. column of our data table) is
useful, we are often more interested in understanding the relationships
between multiple variables. For instance, how do you think a player’s
free throw percentage (FTP) is related to his field goal percentage
(FGP)?</p>
<p>To make a scatterplot in R, we can run the following code. Notice
that it is very similar to the code used to make histograms, but with a
few important differences</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + geom_point(mapping = aes(x = FGP, y = FTP))</code></pre>
<p><img src="lecture2_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Just like the code used to produce the histograms above, we began by
calling <code>ggplot(data = nba_shooting)</code>. Now, however, instead
of calling <code>geom_histogram()</code> we are calling
<code>geom_point()</code>. This tells R that instead of a histogram, we
want to plot the data using points. We will learn much more about the
different “geom” objects available in ggplot2 in Lecture 4. Since we are
plotting multiple variables, we need to tell R to which axis each
variable is mapped. This is exactly
what<code>mapping = aes(x = FGP, y = FTP)</code> does.</p>
<p>Immediately, we notice a few things about the figure. First, we see
what appears to be a big black cloud of points in the middle of the
plotting region. This is a result of R trying to plot lots and lots of
data points in a small region of the plane. Additionally, we find a few
rather interesting data points, corresponding to players who have never
made a field goal but are perfect free throw shooters and to players who
have never missed a field goal but have made only 50% of their free
throws. A major drawback of this scatterplot is its inability to show
the relative density of points. That is, does the point at (1.00, 0.50)
correspond to a single player or does it correspond to multiple
ones?</p>
<p>One way to address this is to use <em>alpha-blending</em> to change
the transparency of each point. When there are many points plotted in
the same region, that region will appear darker.</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + geom_point(mapping = aes(x = FGP, y = FTP), alpha = 0.1)</code></pre>
<p><img src="lecture2_files/figure-html/scatterplot-alpha-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now we can start to distinguish the number of players represented by
each point. The fact that the point at (0.00, 0.50) is much darker than
the point at (0.00, 1.00) indicates that there are more players who
missed every one of their field goal attempts and made 50% of their free
throws than players who missed every field goal but made every free
throw.</p>
<p>To get an even better idea, we can make a <em>heatmap</em>, which you
can think of as a two-dimensional analog of a histogram. To form a
heatmap, you start by dividing the plane into lots of evenly-sized
two-dimensional bins and counting the number of datapoints within each
bin. You then color the bin according to the count. While you can
conceptually make the bins any shape you want, there are two popular
conventions: rectangular binning and hexagonal binning. For the purposes
of this course, we will focus on rectangular binning, using the
<code>geom_bin2d()</code> function.</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + geom_bin2d(aes(x = FGP, y = FTP))</code></pre>
<p><img src="lecture2_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can increase the number of bins to get a much more high-resolution
view of our data.</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + geom_bin2d(mapping = aes(x = FGP, y = FTP), bins = 100)</code></pre>
<p><img src="lecture2_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now we are starting to get some sense that there are some outliers in
our data. We can confirm this visually in another way</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + geom_point(mapping = aes(x = FGA, y = FGP), alpha = 0.1)</code></pre>
<p><img src="lecture2_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Sometimes, we don’t want to look at the entire range of the data and
only want to plot a smaller window. We can do this by changing the x and
y limits of the plotting region</p>
<pre class="r"><code>&gt; ggplot(data = raw_shooting) + geom_point(aes(x = FGA, y = FGP)) + xlim(0, 200)
Warning: Removed 5346 rows containing missing values (geom_point).</code></pre>
<p><img src="lecture2_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="filtering" class="section level2">
<h2>Filtering</h2>
<p>By this point, it should be clear that there are a number of rather
curious features in our dataset. For instance, there seem to be several
players who have never made a field goal but have made every one of
their free throw attempts. After re-arranging our tbl according to the
number of field goals made, it is clear that we have several players who
have attempted fewer than 5 field goals in a single season. Before
examining the relationship between a player’s field goal percentage and
free throw percentage, we’d like to remove all of the players who have
not attempted many of each type of shot.</p>
<p>The function <code>filter()</code> is used to pull out subsets of
observations that satisfy some logical condition like “FGA &gt; 100” or
“FGA &gt; 100 and FTA &gt; 50”. To make such comparisons in R, we have
the following operators available at our disposal:</p>
<ul>
<li><code>==</code> for “equal to”</li>
<li><code>!=</code> for “not equal to”</li>
<li><code>&lt;</code> and <code>&lt;=</code> for “less than” and “less
than or equal to”</li>
<li><code>&gt;</code> and <code>&gt;=</code> for “greater than” and
“greater than or equal to”</li>
<li><code>&amp;</code>, <code>|</code>, <code>!</code> for “AND” and
“OR” and “NOT” The code below filter out all of the players with at
least 100 field goals in a single season</li>
</ul>
<pre class="r"><code>&gt; filter(raw_shooting, FGA &gt; 100)
# A tibble: 6,295 × 14
   PLAYER            SEASON   FGM   FGA   TPM   TPA   FTM   FTA   FGP   TPP   FTP  eFGP   PTS   TSP
   &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Stephen Curry       2016   805  1597   402   887   363   400 0.504 0.453 0.908 0.630  2375 0.670
 2 James Harden        2016   710  1617   236   657   720   837 0.439 0.359 0.860 0.512  2376 0.598
 3 Kevin Durant        2016   698  1381   186   480   447   498 0.505 0.388 0.898 0.573  2029 0.634
 4 DeMarcus Cousins    2016   601  1332    70   210   476   663 0.451 0.333 0.718 0.477  1748 0.538
 5 LeBron James        2016   737  1416    87   282   359   491 0.520 0.309 0.731 0.551  1920 0.588
 6 Damian Lillard      2016   618  1474   229   610   414   464 0.419 0.375 0.892 0.497  1879 0.560
 7 Anthony Davis       2016   560  1137    35   108   326   430 0.493 0.324 0.758 0.508  1481 0.558
 8 Russell Westbrook   2016   656  1444   101   341   465   573 0.454 0.296 0.812 0.489  1878 0.554
 9 DeMar DeRozan       2016   614  1377    47   139   555   653 0.446 0.338 0.850 0.463  1830 0.550
10 Paul George         2016   605  1448   210   565   454   528 0.418 0.372 0.860 0.490  1874 0.558
# … with 6,285 more rows</code></pre>
<p>When we run this code, you’ll notice that R prints out a tbl with
6,295 rows.</p>
<p>We can also filter on more complicated conditions constructed using
the AND, OR, and NOT operators: <code>&amp;</code>, <code>|</code>, and
<code>!</code>. For instance, to filter observations with at least 100
field goal attempts OR 50 three point attempts, we would do</p>
<pre class="r"><code>&gt; filter(raw_shooting, FGA &gt;= 100 | TPA &gt;= 50)
# A tibble: 6,328 × 14
   PLAYER            SEASON   FGM   FGA   TPM   TPA   FTM   FTA   FGP   TPP   FTP  eFGP   PTS   TSP
   &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Stephen Curry       2016   805  1597   402   887   363   400 0.504 0.453 0.908 0.630  2375 0.670
 2 James Harden        2016   710  1617   236   657   720   837 0.439 0.359 0.860 0.512  2376 0.598
 3 Kevin Durant        2016   698  1381   186   480   447   498 0.505 0.388 0.898 0.573  2029 0.634
 4 DeMarcus Cousins    2016   601  1332    70   210   476   663 0.451 0.333 0.718 0.477  1748 0.538
 5 LeBron James        2016   737  1416    87   282   359   491 0.520 0.309 0.731 0.551  1920 0.588
 6 Damian Lillard      2016   618  1474   229   610   414   464 0.419 0.375 0.892 0.497  1879 0.560
 7 Anthony Davis       2016   560  1137    35   108   326   430 0.493 0.324 0.758 0.508  1481 0.558
 8 Russell Westbrook   2016   656  1444   101   341   465   573 0.454 0.296 0.812 0.489  1878 0.554
 9 DeMar DeRozan       2016   614  1377    47   139   555   653 0.446 0.338 0.850 0.463  1830 0.550
10 Paul George         2016   605  1448   210   565   454   528 0.418 0.372 0.860 0.490  1874 0.558
# … with 6,318 more rows</code></pre>
<p>We may combine these constraints by enclosing them in
parantheses.</p>
<pre class="r"><code>&gt; filter(raw_shooting, (FGA &gt;= 100 &amp; TPA &gt;= 50) | (FGP &gt;= 0.45 &amp; FGP &lt;= 0.5))
# A tibble: 4,837 × 14
   PLAYER            SEASON   FGM   FGA   TPM   TPA   FTM   FTA   FGP   TPP   FTP  eFGP   PTS   TSP
   &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Stephen Curry       2016   805  1597   402   887   363   400 0.504 0.453 0.908 0.630  2375 0.670
 2 James Harden        2016   710  1617   236   657   720   837 0.439 0.359 0.860 0.512  2376 0.598
 3 Kevin Durant        2016   698  1381   186   480   447   498 0.505 0.388 0.898 0.573  2029 0.634
 4 DeMarcus Cousins    2016   601  1332    70   210   476   663 0.451 0.333 0.718 0.477  1748 0.538
 5 LeBron James        2016   737  1416    87   282   359   491 0.520 0.309 0.731 0.551  1920 0.588
 6 Damian Lillard      2016   618  1474   229   610   414   464 0.419 0.375 0.892 0.497  1879 0.560
 7 Anthony Davis       2016   560  1137    35   108   326   430 0.493 0.324 0.758 0.508  1481 0.558
 8 Russell Westbrook   2016   656  1444   101   341   465   573 0.454 0.296 0.812 0.489  1878 0.554
 9 DeMar DeRozan       2016   614  1377    47   139   555   653 0.446 0.338 0.850 0.463  1830 0.550
10 Paul George         2016   605  1448   210   565   454   528 0.418 0.372 0.860 0.490  1874 0.558
# … with 4,827 more rows</code></pre>
<p>What if we wanted to pull out the observations corresponding to the
2015-16 and 2014-15 season. We could do something like
<code>filter(raw_shooting, (SEASON == 2016) | (SEASON == 2015))</code>,
which would be perfectly fine. However, what if we wanted data from
1998-99, 2011-12, and 2015-16? Typing a lot of expressions like
<code>SEASON == ...</code> would be rather tedious. The
<code>%in%</code> operator lets us avoid this tedium:</p>
<pre class="r"><code>&gt; filter(raw_shooting, SEASON %in% c(1999, 2012, 2016))
# A tibble: 1,150 × 14
   PLAYER            SEASON   FGM   FGA   TPM   TPA   FTM   FTA   FGP   TPP   FTP  eFGP   PTS   TSP
   &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Stephen Curry       2016   805  1597   402   887   363   400 0.504 0.453 0.908 0.630  2375 0.670
 2 James Harden        2016   710  1617   236   657   720   837 0.439 0.359 0.860 0.512  2376 0.598
 3 Kevin Durant        2016   698  1381   186   480   447   498 0.505 0.388 0.898 0.573  2029 0.634
 4 DeMarcus Cousins    2016   601  1332    70   210   476   663 0.451 0.333 0.718 0.477  1748 0.538
 5 LeBron James        2016   737  1416    87   282   359   491 0.520 0.309 0.731 0.551  1920 0.588
 6 Damian Lillard      2016   618  1474   229   610   414   464 0.419 0.375 0.892 0.497  1879 0.560
 7 Anthony Davis       2016   560  1137    35   108   326   430 0.493 0.324 0.758 0.508  1481 0.558
 8 Russell Westbrook   2016   656  1444   101   341   465   573 0.454 0.296 0.812 0.489  1878 0.554
 9 DeMar DeRozan       2016   614  1377    47   139   555   653 0.446 0.338 0.850 0.463  1830 0.550
10 Paul George         2016   605  1448   210   565   454   528 0.418 0.372 0.860 0.490  1874 0.558
# … with 1,140 more rows</code></pre>
<p>We could also filter out data from the two lockout-shortened seasons,
1998-99 and 2011-12 using a combination of the NOT <code>!</code>
operator and <code>%in%</code>.</p>
<pre class="r"><code>&gt; filter(raw_shooting, !SEASON %in% c(1999, 2012))
# A tibble: 6,721 × 14
   PLAYER            SEASON   FGM   FGA   TPM   TPA   FTM   FTA   FGP   TPP   FTP  eFGP   PTS   TSP
   &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Stephen Curry       2016   805  1597   402   887   363   400 0.504 0.453 0.908 0.630  2375 0.670
 2 James Harden        2016   710  1617   236   657   720   837 0.439 0.359 0.860 0.512  2376 0.598
 3 Kevin Durant        2016   698  1381   186   480   447   498 0.505 0.388 0.898 0.573  2029 0.634
 4 DeMarcus Cousins    2016   601  1332    70   210   476   663 0.451 0.333 0.718 0.477  1748 0.538
 5 LeBron James        2016   737  1416    87   282   359   491 0.520 0.309 0.731 0.551  1920 0.588
 6 Damian Lillard      2016   618  1474   229   610   414   464 0.419 0.375 0.892 0.497  1879 0.560
 7 Anthony Davis       2016   560  1137    35   108   326   430 0.493 0.324 0.758 0.508  1481 0.558
 8 Russell Westbrook   2016   656  1444   101   341   465   573 0.454 0.296 0.812 0.489  1878 0.554
 9 DeMar DeRozan       2016   614  1377    47   139   555   653 0.446 0.338 0.850 0.463  1830 0.550
10 Paul George         2016   605  1448   210   565   454   528 0.418 0.372 0.860 0.490  1874 0.558
# … with 6,711 more rows</code></pre>
<p>For the remainder of this module, we will focus on the players who
attempted at least 100 field goals, 100 free throws, 50 three pointers
in the non-lockout seasons.</p>
<pre class="r"><code>&gt; nba_shooting &lt;- filter(raw_shooting, (FGA &gt;= 100 &amp; FTA &gt;= 100 &amp; TPA &gt;= 50 &amp; !SEASON %in% c(1999, 2012)))
&gt; nba_shooting
# A tibble: 2,254 × 14
   PLAYER            SEASON   FGM   FGA   TPM   TPA   FTM   FTA   FGP   TPP   FTP  eFGP   PTS   TSP
   &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Stephen Curry       2016   805  1597   402   887   363   400 0.504 0.453 0.908 0.630  2375 0.670
 2 James Harden        2016   710  1617   236   657   720   837 0.439 0.359 0.860 0.512  2376 0.598
 3 Kevin Durant        2016   698  1381   186   480   447   498 0.505 0.388 0.898 0.573  2029 0.634
 4 DeMarcus Cousins    2016   601  1332    70   210   476   663 0.451 0.333 0.718 0.477  1748 0.538
 5 LeBron James        2016   737  1416    87   282   359   491 0.520 0.309 0.731 0.551  1920 0.588
 6 Damian Lillard      2016   618  1474   229   610   414   464 0.419 0.375 0.892 0.497  1879 0.560
 7 Anthony Davis       2016   560  1137    35   108   326   430 0.493 0.324 0.758 0.508  1481 0.558
 8 Russell Westbrook   2016   656  1444   101   341   465   573 0.454 0.296 0.812 0.489  1878 0.554
 9 DeMar DeRozan       2016   614  1377    47   139   555   653 0.446 0.338 0.850 0.463  1830 0.550
10 Paul George         2016   605  1448   210   565   454   528 0.418 0.372 0.860 0.490  1874 0.558
# … with 2,244 more rows</code></pre>
</div>
<div id="creating-categorical-variables" class="section level2">
<h2>Creating Categorical Variables</h2>
<p>So far, we have used <code>mutate()</code> to compute numeric or
continuous variables. Often in an analysis, however, we may want to
<em>bin</em> these values into smaller buckets or categories. For
instance, we may rather arbitrarily classify players based on their
three-point shooting prowess as follows:</p>
<ul>
<li>Hopeless: TPP &lt; 20%</li>
<li>Below Average: 20% &lt;= TPP &lt; 30%</li>
<li>Average: 30% &lt;= TPP &lt; 35%</li>
<li>Above Average: 35% &lt; TPP &lt; 40%</li>
<li>Elite: TPP &gt; 40%</li>
</ul>
<p>In order to add a column to <code>nba_shooting</code> that includes
these classifications, we can use the <code>case_when()</code>
function</p>
<pre class="r"><code>&gt; nba_shooting &lt;- mutate(nba_shooting,
+                        Classification = case_when(
+                          TPP &lt; 0.2 ~  &quot;Hopeless&quot;,
+                          0.2 &lt;= TPP &amp; TPP &lt; 0.3 ~ &quot;Below Average&quot;,
+                          0.3 &lt;= TPP &amp; TPP &lt; 0.35 ~  &quot;Average&quot;,
+                          0.35 &lt;= TPP &amp; TPP &lt; 0.4 ~ &quot;Above Average&quot;,
+                          0.4 &lt;= TPP ~ &quot;Elite&quot;))</code></pre>
<p>Let’s take a minute to unpack the code above. Within
<code>mutate()</code>, we have started like we always did, with the name
of the new variable on the left hand side of an equal sign. Then we
called the <code>case_when()</code> function. Within this function, we
have a new line for each of the values of the new variable
“Classification”. On each line we have an expression with a tilde
(<code>~</code>). On the left of the <code>~</code>, we have put a
logical expression and on the right we have written the value of
“Clasification.”</p>
</div>
<div id="summarizing-individual-columns" class="section level2">
<h2>Summarizing Individual Columns</h2>
<p>Among eligible players, what was the average field goal percentage in
the 2015-16 season? To answer this, we can use <code>filter()</code> to
create a new tbl containing the data only for this season. Then we can
use the dplyr verb <code>summarize()</code> as follows:</p>
<pre class="r"><code>&gt; nba_shooting_2016 &lt;- filter(nba_shooting, SEASON == 2016)
&gt; summarize(nba_shooting_2016, FGP = mean(FGP))
# A tibble: 1 × 1
    FGP
  &lt;dbl&gt;
1 0.438
&gt; summarize(nba_shooting_2016, FGP = mean(FGP), TPP = mean(TPP), FTP = mean(FTP))
# A tibble: 1 × 3
    FGP   TPP   FTP
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 0.438 0.346 0.790</code></pre>
<p>In the first line, we compute the average field goal percentage and
in the second example, we compute the average field goal, three point,
and free throw percentages. Of course, we are not limited to computing
just the mean. The following functions are quite useful for summarizing
several aspects of the distribution of the variables in our dataset:</p>
<ul>
<li>Center: <code>mean()</code>, <code>median()</code></li>
<li>Spread: <code>sd()</code>, <code>IQR()</code></li>
<li>Range: <code>min()</code>, <code>max()</code></li>
<li>Count: <code>n()</code>, <code>n_distinct()</code></li>
</ul>
<p>We will have much more to say about <code>summarize()</code> in <a
href="lecture3.html">Lecture 3</a> when we discuss grouped
manipulations.</p>
<div id="selecting-columns" class="section level3">
<h3>Selecting Columns</h3>
<p>Oftentimes, the dataset you load into R contains many, many more
columns than you need. We can use <code>select()</code> to pull out the
columns we want to use in our subsequent analyses. For instance, we may
want to only focus on the columns SEASON, FGP, TPP, FTP, eFGP, PTS, and
TSP and ignore the rest of the columns.</p>
<pre class="r"><code>&gt; select(nba_shooting, PLAYER, SEASON, FGP, TPP, FTP, eFGP, PTS, TSP)
# A tibble: 2,254 × 8
   PLAYER            SEASON   FGP   TPP   FTP  eFGP   PTS   TSP
   &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Stephen Curry       2016 0.504 0.453 0.908 0.630  2375 0.670
 2 James Harden        2016 0.439 0.359 0.860 0.512  2376 0.598
 3 Kevin Durant        2016 0.505 0.388 0.898 0.573  2029 0.634
 4 DeMarcus Cousins    2016 0.451 0.333 0.718 0.477  1748 0.538
 5 LeBron James        2016 0.520 0.309 0.731 0.551  1920 0.588
 6 Damian Lillard      2016 0.419 0.375 0.892 0.497  1879 0.560
 7 Anthony Davis       2016 0.493 0.324 0.758 0.508  1481 0.558
 8 Russell Westbrook   2016 0.454 0.296 0.812 0.489  1878 0.554
 9 DeMar DeRozan       2016 0.446 0.338 0.850 0.463  1830 0.550
10 Paul George         2016 0.418 0.372 0.860 0.490  1874 0.558
# … with 2,244 more rows</code></pre>
</div>
</div>
<div id="saving-our-work" class="section level2">
<h2>Saving our work</h2>
<p>By this point, the <code>nba_shooting</code> tbl has much more
information in it than the original data file we read in. While we can
always re-run the commands used to produce this tbl from our script,
when data analyses become more complicated, it is helpful to save these
objects. R has its own special file format for efficiently saving data
on your computer.</p>
<p>We will use the <code>save()</code> command.</p>
<pre class="r"><code>&gt; save(nba_shooting, file = &quot;data/nba_shooting.RData&quot;)</code></pre>
<p>When we want to <em>load</em> the data back into R, we can use the
<code>load()</code> function</p>
<pre class="r"><code>&gt; load(&quot;data/nba_shooting.RData&quot;)</code></pre>
</div>
<div id="thinking-ahead-for-tomorrow" class="section level2">
<h2>Thinking Ahead for Tomorrow</h2>
<p>Up to this point, we have only used the dplyr verbs
<code>mutate()</code>, <code>filter()</code>, and <code>arrange()</code>
one at a time. What if we wanted to do something a bit more complicated
like:</p>
<ol style="list-style-type: decimal">
<li>Remove players from the lockout season who had fewer than 100 field
goal attempts, fewer than 100 free throw attempts, or fewer than 50
three point attempts</li>
<li>Arrange them according to their three point percentage.</li>
<li>Add a classification of their three point shooting ability (as we
did above with <code>case_when()</code>)</li>
<li>Compute the mean field goal percentage of all of the players within
each of these categories. That is, separately compute the mean field
goal percentage of the “Elite” three point shooters, the “Above Average”
three point shooters, etc.</li>
</ol>
<p>In <a href="lecture3.html">Lecture 3</a>, we will learn how to string
together several dplyr verbs to perform the above tasks. We will also
learn how to perform grouped calculations.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
